#!/bin/bash

lid_status() {
  cat /proc/acpi/button/lid/LID/state | cut -d\: -f2 | xargs
}

caps_lock() {
  xset -q | sed -n 's/^.*Caps Lock:\s*\(\S*\).*$/\1/p'
}

while true; do
  sleep 10
  if [ $(lid_status) == "closed" ]; then
    continue
  fi
  if [ $(caps_lock) == "on" ]; then
    xdotool key Caps_Lock
  fi
  setxkbmap -option 'ctrl:nocaps'
done
